<div class="main-content">
  <div class="title">
    <h1>üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h1>
  </div>

  <div class="table-filter">
    <p-card header="–§–∏–ª—å—Ç—Ä">
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">

        <!-- –ö–æ–ª–æ–Ω–∫–∞ 1 -->
        <div style="flex: 1; line-height: 2; width: 100%; display: grid">
          <label>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</label>
          <p-multiSelect
            [options]="riskOptions"
            [(ngModel)]="selectedRisks"
            optionLabel="label"
            optionValue="value"
            display="chip"
            [style]="{width: '100%'}"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞">
          </p-multiSelect>
        </div>

        <!-- –ö–æ–ª–æ–Ω–∫–∞ 2 -->
        <div style="flex: 1;">
          <label class="p-d-block mb-2" style="line-height: 1.8;">
            –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞: –æ—Ç {{ riskRange[0] }} –¥–æ {{ riskRange[1] }}
          </label>
          <p-slider
            [(ngModel)]="riskRange"
            [min]="1"
            [max]="5"
            [step]="1"
            [range]="true"
            [style]="{width: '100%', height: '10px'}">
          </p-slider>
        </div>

      </div>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
        <!-- –ö–æ–ª–æ–Ω–∫–∞ 3 (–Ω–∞–ø—Ä–∏–º–µ—Ä, dropdown –ø–æ —Å—Ç—Ä–∞–Ω–µ) -->
        <div style="flex: 1; line-height: 2; ">
          <label class="p-d-block mb-2">
            –î–∏–∞–ø–∞–∑–æ–Ω —Å—É–º–º : –æ—Ç {{ amountRange[0] }} –¥–æ {{ amountRange[1] }}
          </label>
          <p-slider
            [(ngModel)]="amountRange"
            [min]="10000"
            [max]="50000000"
            [step]="1"
            [range]="true"
            [style]="{width: '100%', height: '10px'}"
          >
          </p-slider>
        </div>

        <!-- –ö–æ–ª–æ–Ω–∫–∞ 3 (–Ω–∞–ø—Ä–∏–º–µ—Ä, dropdown –ø–æ —Å—Ç—Ä–∞–Ω–µ) -->
        <div style="flex: 1;  line-height: 2; width: 100%; display: grid">
          <label>–°—Ä–∞–±–æ—Ç–∞–≤—à–∏–µ –ø—Ä–∞–≤–∏–ª–∞</label>
          <p-multiSelect
            [maxSelectedLabels]="2"
            [options]="ruleDescriptionOptions"
            [(ngModel)]="selectedRules"
            optionLabel="label"
            display="chip"
            [style]="{width: '100%'}"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ">
          </p-multiSelect>

        </div>
      </div>

      <div class="actions">
        <p-button (click)="submitFilter()" label="–ü–æ–∏—Å–∫" />

        <p-button (click)="resetFilter()" label="–°–±—Ä–æ—Å–∏—Ç—å" [outlined]="true" severity="warning" />

      </div>
    </p-card>
  </div>

  <div class="results-table">
    <h2>–ù–∞–π–¥–µ–Ω–æ {{ results?.length }} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h2>

    <p-table
      [value]="results"
      [paginator]="true"
      [rows]="20"
      [rowsPerPageOptions]="[20, 50, 100]"
      responsiveLayout="scroll">

      <ng-template pTemplate="header">
        <tr>
          <th>ID</th>
          <th>–î–∞—Ç–∞</th>
          <th>–°—É–º–º–∞ (USD)</th>
          <th>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</th>
          <th>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</th>
          <th>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</th>
          <th>–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-tx>
        <tr>
          <td>{{ tx.transaction_id }}</td>
          <td>{{ tx.analysis_details.transaction_date | date:'short' }}</td>
          <td>{{ tx.analysis_details.amount }}</td>
          <td>{{ tx.analysis_details.payer_info }}</td>
          <td>{{ tx.analysis_details.receiver_info }}</td>
          <td>{{ tx.risk_level }}</td>
          <td>{{ tx.risk_score }}</td>
        </tr>
      </ng-template>
    </p-table>

    <p-button size="small" label="–°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ CSV" [outlined]="true" severity="contrast"/>

  </div>

  <div class="transaction-details">
    <h2>–î–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π</p>
    <p-dropdown
      [style]="{ width: '100%' }"
      [options]="transactionOptions"
      [(ngModel)]="selectedTransactionId"
      optionLabel="label"
      optionValue="value"
      (onChange)="onTransactionSelect($event.value)"
      placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é">
    </p-dropdown>


    <div class="two-column-container">
      <div class="column left" *ngIf="selectedTransaction">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->

        <div class="main-info-container">
          <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
          <p>ID: <span>{{ selectedTransaction?.transaction_id }}</span></p>
          <p>–î–∞—Ç–∞: <span>{{ selectedTransaction?.analysis_details?.transaction_date }}</span></p>
          <p>–°—É–º–º–∞:
            <span>{{ selectedTransaction?.analysis_details?.amount }} {{ selectedTransaction?.analysis_details?.currency }}</span>
          </p>
          <p>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏: ?</p>
        </div>


        <div class="payment-purpose-container">
          <h2>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞</h2>
          <textarea
            style="width: 100%; height: 100px;"
            readonly
            rows="5"
            cols="30"
            pInputTextarea
            [value]="selectedTransaction?.analysis_details?.description"></textarea>
        </div>

        <div class="payer-info">
          <h2>–ü–ª–∞—Ç–µ–ª—å—â–∏–∫</h2>

          <p>–ò–º—è: {{ getPayerInfoName(selectedTransaction?.analysis_details?.payer_info ?? '') }}</p>
          <p>–ò–ò–ù/–ë–ò–ù: {{ getPayerInfoIDN(selectedTransaction?.analysis_details?.payer_info ?? '') }}</p>
          <p>–°—Ç—Ä–∞–Ω–∞: ?</p>
        </div>

        <div class="receiver_info">
          <h2>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</h2>

          <p>–ò–º—è: {{ getPayerInfoName(selectedTransaction.analysis_details.receiver_info ?? '') }}</p>
          <p>–ò–ò–ù/–ë–ò–ù: {{ getPayerInfoIDN(selectedTransaction.analysis_details.receiver_info ?? '') }}</p>
          <p>–°—Ç—Ä–∞–Ω–∞: ?</p>
        </div>
      </div>
      <div class="column right" *ngIf="selectedTransaction">
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="check-result-container">
          <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
          <p>–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞: {{ selectedTransaction?.risk_score }}/10</p>

          <p>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: {{ selectedTransaction?.risk_level }}</p>
        </div>
        <div class="rule_description">
          <h2>–°—Ä–∞–±–æ—Ç–∞–≤—à–∏–µ –ø—Ä–∞–≤–∏–ª–∞</h2>

          <ul style="line-height: 1.6; padding-left: 1.2rem; margin: 0;">
            <li *ngFor="let desc of selectedTransaction?.rule_descriptions; let i = index;">
              {{ desc }}
            </li>
          </ul>
        </div>
        <div class="recommendations-container" *ngIf="selectedTransaction">
          <h2>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
          <p-messages
            [(value)]="recommendationMessages"
            [enableService]="false"
            [closable]="false"/>
        </div>
        <div class="triggered_rules">
          <h2>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
          <p-panel header="–í—Å–µ –ø–æ–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏" [toggleable]="true">
            <ul style="line-height: 1.6; padding-left: 1.2rem; margin: 0;">
              <li *ngFor="let rule of selectedTransaction?.triggered_rules">
                {{ rule }}
              </li>
            </ul>
          </p-panel>

        </div>
      </div>
    </div>

  </div>
</div>
